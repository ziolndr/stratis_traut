<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ARBITER • Semantic Intelligence</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    :root {
      --bg-primary: #09090b;
      --bg-secondary: #18181b;
      --bg-tertiary: #27272a;
      --border: rgba(255,255,255,0.08);
      --border-hover: rgba(255,255,255,0.15);
      --text-primary: #fafafa;
      --text-secondary: #a1a1aa;
      --text-muted: #71717a;
      --accent-blue: #3b82f6;
      --accent-purple: #8b5cf6;
      --accent-emerald: #10b981;
      --accent-amber: #f59e0b;
      --accent-rose: #f43f5e;
      --glow-blue: rgba(59, 130, 246, 0.5);
      --glow-purple: rgba(139, 92, 246, 0.5);
    }
    
    body { 
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    /* Scrollbar */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--bg-tertiary); border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #3f3f46; }
    
    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    
    @keyframes glow {
      0%, 100% { box-shadow: 0 0 20px var(--glow-blue); }
      50% { box-shadow: 0 0 40px var(--glow-purple); }
    }
    
    @keyframes scoreReveal {
      0% { width: 0%; opacity: 0; }
      100% { opacity: 1; }
    }
    
    .fade-in { animation: fadeIn 0.4s ease-out forwards; }
    .fade-in-delay-1 { animation-delay: 0.1s; opacity: 0; }
    .fade-in-delay-2 { animation-delay: 0.2s; opacity: 0; }
    .fade-in-delay-3 { animation-delay: 0.3s; opacity: 0; }
    
    /* Glass morphism */
    .glass {
      background: rgba(24, 24, 27, 0.8);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--border);
    }
    
    .glass-hover:hover {
      border-color: var(--border-hover);
      background: rgba(39, 39, 42, 0.8);
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      .home-cards {
        grid-template-columns: 1fr !important;
        gap: 16px !important;
        padding: 0 16px !important;
      }
      
      .home-title {
        font-size: 36px !important;
      }
      
      .perspective-grid {
        grid-template-columns: 1fr !important;
      }
      
      .persona-sidebar {
        border-right: none !important;
        border-bottom: 1px solid var(--border) !important;
        max-height: 50vh;
        overflow-y: auto;
      }
      
      .results-panel {
        padding: 16px !important;
      }
      
      .header-mobile {
        padding: 16px !important;
        flex-direction: column;
        gap: 8px;
        align-items: flex-start !important;
      }
      
      .arbitration-hypotheses {
        flex-direction: column !important;
      }
      
      .winner-banner {
        padding: 24px !important;
      }
      
      .winner-score {
        font-size: 32px !important;
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;
    
    // Production: runs local. Demo: remote endpoint for demonstration.
    const ARBITER_API = 'https://api.arbiter.traut.ai/public/compare';

    // Intelligence corpus - 18 essential signals that create the moments
    const INTELLIGENCE_CORPUS = [
      // THE HUMAN STORIES (5) — For Babusya, Journalist, Zelensky
      {
        id: 'HUMINT-001',
        timestamp: '2024-12-10T21:30:00Z',
        source: 'HUMINT',
        classification: 'SECRET',
        content: 'Soldiers observed drinking heavily in border town bars, speaking of goodbyes to families. Multiple witnesses report emotional farewells and fatalistic talk. Pattern consistent with personnel expecting imminent deployment to combat.',
        region: 'Border Region'
      },
      {
        id: 'HUMINT-002',
        timestamp: '2024-12-10T14:15:00Z',
        source: 'HUMINT',
        classification: 'CONFIDENTIAL',
        content: 'Grandson called grandmother unexpectedly from military base. Conversation described as emotional. He asked her to "take care of the family garden" - phrase previously used before 2014 deployment. Source is 73-year-old resident of border village.',
        region: 'Eastern District'
      },
      {
        id: 'HUMINT-003',
        timestamp: '2024-12-10T11:00:00Z',
        source: 'HUMINT',
        classification: 'CONFIDENTIAL',
        content: 'Children being evacuated from border village schools mid-term. Parents arriving with vehicles packed with belongings. Teachers instructed to release students without explanation. Similar pattern observed in three adjacent villages.',
        region: 'Border Region'
      },
      {
        id: 'HUMINT-004',
        timestamp: '2024-12-10T18:00:00Z',
        source: 'HUMINT',
        classification: 'CONFIDENTIAL',
        content: 'Local priest held special confession services. Church remained open until midnight. Elderly parishioners describe atmosphere as "like before the last war." Priest declined to comment but was observed blessing military-age men.',
        region: 'Border Region'
      },
      {
        id: 'OSINT-005',
        timestamp: '2024-12-10T22:00:00Z',
        source: 'OSINT',
        classification: 'UNCLASSIFIED',
        content: 'Military families posting farewell messages on social media. Geolocated to garrison towns. Posts reference "praying for safe return" and "until we meet again." Engagement patterns suggest genuine emotional content, not coordinated messaging.',
        region: 'Central Region'
      },
      // THE ENVIRONMENTAL (3) — For The Land
      {
        id: 'MASINT-006',
        timestamp: '2024-12-11T06:00:00Z',
        source: 'MASINT',
        classification: 'SECRET',
        content: 'Fish behavior anomalies detected in border river. Schools moving away from northern banks. Local fishermen report catches down 80% in past 72 hours. Pattern preceded ground operations in 2014 by approximately 96 hours.',
        region: 'River Corridor'
      },
      {
        id: 'HUMINT-007',
        timestamp: '2024-12-11T04:30:00Z',
        source: 'HUMINT',
        classification: 'UNCLASSIFIED',
        content: 'Stray dogs observed fleeing border areas in unusual numbers. Animal shelter in nearby town reports 300% increase in strays arriving from east. Local veterinarian notes animals appear stressed, disoriented.',
        region: 'Border Region'
      },
      {
        id: 'MASINT-008',
        timestamp: '2024-12-11T05:00:00Z',
        source: 'MASINT',
        classification: 'CONFIDENTIAL',
        content: 'Migratory birds altering flight patterns over border zone. Flocks observed diverting around areas with no visible obstruction. Wildlife biologists note pattern inconsistent with normal seasonal behavior. Similar deviation preceded 2022 incursion.',
        region: 'Border Airspace'
      },
      // THE SILENCES (4) — For The Silence persona
      {
        id: 'OSINT-009',
        timestamp: '2024-12-11T12:00:00Z',
        source: 'OSINT',
        classification: 'UNCLASSIFIED',
        content: 'Social media posts from military personnel suddenly ceased. Accounts that posted daily now silent for 72+ hours. No farewell posts, no explanations. Pattern affects personnel in forward-deployed units. Digital silence preceded physical movement in previous operations.',
        region: 'Digital Environment'
      },
      {
        id: 'OSINT-010',
        timestamp: '2024-12-11T13:00:00Z',
        source: 'OSINT',
        classification: 'UNCLASSIFIED',
        content: 'Military families stopped posting on social networks. Spouse groups that shared daily updates now inactive. Pattern shifted from sharing to silence within 48-hour window. No official communication requesting operational security.',
        region: 'Digital Environment'
      },
      {
        id: 'OSINT-011',
        timestamp: '2024-12-11T15:00:00Z',
        source: 'OSINT',
        classification: 'UNCLASSIFIED',
        content: 'Defense ministry spokesperson availability reduced to zero. Previously held daily briefings, now cancelled indefinitely citing "scheduling." Journalists report all requests for comment unanswered. Information vacuum emerging.',
        region: 'Official Communications'
      },
      {
        id: 'TECHINT-012',
        timestamp: '2024-12-11T16:00:00Z',
        source: 'TECHINT',
        classification: 'SECRET',
        content: 'Flight tracking data gaps appear over military airfields. ADS-B coverage shows aircraft disappearing from tracking near bases. Pattern consistent with transponder deactivation or jamming. Commercial flights rerouting around affected areas.',
        region: 'Airspace'
      },
      // THE CRIMEA SIGNALS (3) — For World Arbitration / Kerch hypothesis
      {
        id: 'SATINT-013',
        timestamp: '2024-12-11T10:00:00Z',
        source: 'SATINT',
        classification: 'SECRET',
        content: 'Satellite imagery confirms evacuation buses staged in Crimean towns near Kerch bridge. 47 buses identified, civilian markings. Positioned at schools and community centers. No public evacuation announced.',
        region: 'Crimea'
      },
      {
        id: 'HUMINT-014',
        timestamp: '2024-12-10T12:00:00Z',
        source: 'HUMINT',
        classification: 'SECRET',
        content: 'Russian VIPs evacuating families from Crimea. Private aircraft departures from Simferopol increased 600%. Destination primarily Moscow and Dubai. Evacuees include regional administration families and business elites.',
        region: 'Crimea'
      },
      {
        id: 'HUMINT-015',
        timestamp: '2024-12-11T11:00:00Z',
        source: 'HUMINT',
        classification: 'SECRET',
        content: 'Partisan activity reported along Crimean supply routes. Three incidents of rail disruption in 48 hours. Pattern suggests coordinated harassment of logistics. Russian response indicates concern about sustainment vulnerability.',
        region: 'Crimea Approaches'
      },
      // THE OPERATIONAL (3) — For Military Analyst
      {
        id: 'SIGINT-016',
        timestamp: '2024-12-11T00:00:00Z',
        source: 'SIGINT',
        classification: 'TOP SECRET',
        content: 'Encrypted radio traffic tripled on military command networks. New callsigns detected not matching any known unit designations. Frequency hopping patterns shifted from training protocols to operational configurations.',
        region: 'Multiple Sectors'
      },
      {
        id: 'SIGINT-017',
        timestamp: '2024-12-11T02:00:00Z',
        source: 'SIGINT',
        classification: 'TOP SECRET',
        content: 'GPS jamming detected across 200km front. Jamming intensity increased 400% over 48 hours. Pattern consistent with pre-operational electronic warfare preparation. Civilian navigation systems affected in border zone.',
        region: 'Border Region'
      },
      {
        id: 'SIGINT-018',
        timestamp: '2024-12-11T03:00:00Z',
        source: 'SIGINT',
        classification: 'TOP SECRET',
        content: 'Unusual silence on military frequencies normally active. Routine traffic ceased at 0200 hours. Pattern consistent with communications blackout preceding operations. Similar signature observed 72 hours before previous offensive.',
        region: 'Northern Sector'
      }
    ];

    // Perspective personas - geometric markers, words do the work
    const PERSONAS = [
      {
        id: 'journalist',
        name: 'War Correspondent',
        marker: '○',
        description: 'Finds the human story that leads the broadcast',
        query: 'As a war correspondent looking for the emotional truth of what is happening, what details would I lead my story with? What moments capture the human experience of war approaching?'
      },
      {
        id: 'babusya',
        name: 'Babusya',
        marker: '○',
        description: 'Survived the last war. Knows the signs.',
        query: 'As an elderly grandmother in a border village who survived previous wars, what signs would tell me it is time to take my grandchildren and leave? What would I notice that officials would not announce?'
      },
      {
        id: 'analyst',
        name: 'Military Analyst',
        marker: '△',
        description: 'Tracks operational indicators and warnings',
        query: 'As a military intelligence analyst tracking indicators and warnings, what signals demand immediate attention? What patterns suggest transition from posture to action?'
      },
      {
        id: 'silence',
        name: 'The Silence',
        marker: '◇',
        description: 'Finds what is NOT happening. The gaps.',
        query: 'What is conspicuously absent? What normally happens that has stopped? What voices have gone quiet? What data has gaps? What routines have broken? The silence before the storm - what is NOT happening that should be?'
      },
      {
        id: 'humanitarian',
        name: 'Humanitarian Coordinator',
        marker: '△',
        description: 'Must position resources before displacement begins',
        query: 'As a humanitarian aid coordinator who must pre-position resources, what signals indicate civilian displacement is imminent? What would tell me to activate emergency protocols?'
      },
      {
        id: 'land',
        name: 'The Land Itself',
        marker: '□',
        description: 'Rivers, animals, earth feel what humans ignore',
        query: 'As the land itself - the rivers, the soil, the animals, the air - what disturbances do I feel in my body? What is different in the fish, the birds, the dogs? What trembles that should be still?'
      },
      {
        id: 'zelensky',
        name: 'President Zelensky',
        marker: '○',
        description: 'Must know what his people face today',
        query: 'As President Zelensky needing to understand what my people face, what would tell me if my citizens will see war today? What signals speak to the human cost my nation is about to bear?'
      },
      {
        id: 'red_team',
        name: 'Adversary (Red Team)',
        marker: '△',
        description: 'What does the enemy see? Have we been detected?',
        query: 'As the adversary commander responsible for this operation, what signals would tell me my preparations have been detected? What would indicate the enemy knows we are coming?'
      }
    ];

    // World hypotheses - the 6 competing realities
    const HYPOTHESES = [
      {
        id: 'kerch',
        name: 'Kerch Vulnerability',
        color: '#f43f5e',
        query: 'In a world where Ukraine is about to destroy the Kerch Bridge, what signals would we observe? Evacuation preparations in Crimea, VIP families leaving, partisan activity on supply routes, Chinese intelligence interest in bridge infrastructure, Russian defensive repositioning.'
      },
      {
        id: 'zaporizhzhia',
        name: 'Zaporizhzhia Seizure',
        color: '#f59e0b',
        query: 'In a world where Russia\'s true objective is seizing the Zaporizhzhia nuclear plant, what signals would cohere? Nuclear rhetoric amplification, specialized unit movements, IAEA communication patterns, evacuation corridors being established, radiation monitoring changes.'
      },
      {
        id: 'crimea_collapse',
        name: 'Crimea Collapse',
        color: '#3b82f6',
        query: 'In a world where Russian leadership has secretly concluded Crimea is lost, what would we observe? Elite family evacuations, asset transfers, supply route hardening, defensive repositioning, propaganda preparing domestic audience for withdrawal.'
      },
      {
        id: 'moldova',
        name: 'Moldova Gambit',
        color: '#8b5cf6',
        query: 'In a world where Russia is preparing a second front through Transnistria into Moldova, what signals would appear? Transnistria garrison activation, Romanian border activity, Moldovan government warnings, NATO eastern flank repositioning, refugee corridor preparation.'
      },
      {
        id: 'maskirovka',
        name: 'Maskirovka (Deception)',
        color: '#10b981',
        query: 'In a world where everything we are observing is deliberate deception to fix our attention while the real operation happens elsewhere, what would cohere? Obvious signals that seem too easy to detect, coordinated media amplification, partisan activity that serves Russian narrative, misdirection patterns.'
      },
      {
        id: 'negotiation',
        name: 'Secret Negotiation',
        color: '#71717a',
        query: 'In a world where backchannel ceasefire negotiations are underway and both sides are posturing for leverage, what would we see? Diplomatic movement, intermediary country activity, military positioning for negotiating advantage rather than combat, media de-escalation signals.'
      }
    ];

    // Main App Component
    function App() {
      const [mode, setMode] = useState(null); // null = home, 'perspective', 'arbitration'
      const [selectedPersona, setSelectedPersona] = useState(null);
      const [results, setResults] = useState([]);
      const [loading, setLoading] = useState(false);
      const [arbitrationResults, setArbitrationResults] = useState(null);
      const [customQuery, setCustomQuery] = useState('');

      const runPerspectiveSearch = async (persona) => {
        setSelectedPersona(persona);
        setLoading(true);
        setResults([]);

        try {
          const scored = [];
          for (const doc of INTELLIGENCE_CORPUS) {
            const response = await fetch(ARBITER_API, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                query: persona.query,
                candidates: [doc.content]
              })
            });
            const data = await response.json();
            const score = data.all?.[0]?.score || 0;
            scored.push({ ...doc, score });
          }
          
          scored.sort((a, b) => b.score - a.score);
          setResults(scored);
        } catch (error) {
          console.error('Search failed:', error);
        }
        
        setLoading(false);
      };

      const runWorldArbitration = async () => {
        setLoading(true);
        setArbitrationResults(null);

        try {
          const hypothesisScores = [];
          
          for (const hypothesis of HYPOTHESES) {
            let totalScore = 0;
            const docScores = [];
            
            for (const doc of INTELLIGENCE_CORPUS) {
              const response = await fetch(ARBITER_API, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  query: hypothesis.query,
                  candidates: [doc.content]
                })
              });
              const data = await response.json();
              const score = data.all?.[0]?.score || 0;
              totalScore += score;
              docScores.push({ doc, score });
            }
            
            const avgScore = totalScore / INTELLIGENCE_CORPUS.length;
            docScores.sort((a, b) => b.score - a.score);
            
            hypothesisScores.push({
              hypothesis,
              avgScore,
              topDocs: docScores.slice(0, 3)
            });
          }
          
          hypothesisScores.sort((a, b) => b.avgScore - a.avgScore);
          
          const winner = hypothesisScores[0];
          const runnerUp = hypothesisScores[1];
          const delta = ((winner.avgScore - runnerUp.avgScore) / runnerUp.avgScore * 100).toFixed(1);
          
          setArbitrationResults({
            hypotheses: hypothesisScores,
            winner,
            runnerUp,
            delta
          });
        } catch (error) {
          console.error('Arbitration failed:', error);
        }
        
        setLoading(false);
      };

      // Home Screen
      if (!mode) {
        return (
          <div style={{
            minHeight: '100vh',
            display: 'flex',
            flexDirection: 'column',
            alignItems: 'center',
            justifyContent: 'center',
            padding: '40px 20px',
            background: 'var(--bg-primary)'
          }}>
            {/* Logo */}
            <div className="fade-in" style={{ textAlign: 'center', marginBottom: '60px' }}>
              <div style={{
                fontSize: '11px',
                letterSpacing: '4px',
                color: '#52525b',
                marginBottom: '20px',
                fontWeight: 500
              }}>
                STRATIS × TRAUT
              </div>
              <h1 className="home-title" style={{
                fontSize: '56px',
                fontWeight: 600,
                letterSpacing: '-1px',
                color: '#fafafa',
                marginBottom: '16px'
              }}>
                ARBITER
              </h1>
              <p style={{
                fontSize: '16px',
                color: 'var(--text-muted)',
                maxWidth: '400px',
                lineHeight: 1.6,
                letterSpacing: '0.5px'
              }}>
                Geometric coherence engine for multi-source intelligence resolution
              </p>
            </div>

            {/* Mode Cards */}
            <div className="home-cards" style={{
              display: 'grid',
              gridTemplateColumns: 'repeat(2, 1fr)',
              gap: '24px',
              maxWidth: '800px',
              width: '100%',
              padding: '0 20px'
            }}>
              {/* Perspective Shift Card */}
              <div
                className="glass glass-hover fade-in fade-in-delay-1"
                onClick={() => setMode('perspective')}
                style={{
                  padding: '40px',
                  borderRadius: '16px',
                  cursor: 'pointer',
                  transition: 'all 0.3s ease',
                  position: 'relative',
                  overflow: 'hidden'
                }}
                onMouseEnter={(e) => {
                  e.currentTarget.style.transform = 'translateY(-2px)';
                  e.currentTarget.style.borderColor = 'var(--border-hover)';
                }}
                onMouseLeave={(e) => {
                  e.currentTarget.style.transform = 'translateY(0)';
                  e.currentTarget.style.borderColor = 'var(--border)';
                }}
              >
                <div style={{
                  position: 'absolute',
                  top: 0,
                  left: 0,
                  right: 0,
                  height: '1px',
                  background: 'var(--border-hover)'
                }} />
                <div style={{ fontSize: '24px', marginBottom: '20px', color: 'var(--text-muted)', fontFamily: 'JetBrains Mono' }}>○ △ □</div>
                <h2 style={{ fontSize: '24px', fontWeight: 600, marginBottom: '12px' }}>
                  Perspective Shift
                </h2>
                <p style={{ color: 'var(--text-secondary)', lineHeight: 1.6, marginBottom: '24px', fontSize: '14px' }}>
                  Same signals. Different observers. Reframe without reprocessing.
                </p>
                <div style={{
                  display: 'inline-flex',
                  alignItems: 'center',
                  gap: '6px',
                  color: 'var(--text-muted)',
                  fontSize: '12px',
                  fontWeight: 400
                }}>
                  Enter →
                </div>
              </div>

              {/* World Arbitration Card */}
              <div
                className="glass glass-hover fade-in fade-in-delay-2"
                onClick={() => { setMode('arbitration'); runWorldArbitration(); }}
                style={{
                  padding: '40px',
                  borderRadius: '16px',
                  cursor: 'pointer',
                  transition: 'all 0.3s ease',
                  position: 'relative',
                  overflow: 'hidden'
                }}
                onMouseEnter={(e) => {
                  e.currentTarget.style.transform = 'translateY(-2px)';
                  e.currentTarget.style.borderColor = 'var(--border-hover)';
                }}
                onMouseLeave={(e) => {
                  e.currentTarget.style.transform = 'translateY(0)';
                  e.currentTarget.style.borderColor = 'var(--border)';
                }}
              >
                <div style={{
                  position: 'absolute',
                  top: 0,
                  left: 0,
                  right: 0,
                  height: '1px',
                  background: 'var(--border-hover)'
                }} />
                <div style={{ fontSize: '24px', marginBottom: '20px', color: 'var(--text-muted)', fontFamily: 'JetBrains Mono' }}>◇</div>
                <h2 style={{ fontSize: '24px', fontWeight: 600, marginBottom: '12px' }}>
                  World Arbitration
                </h2>
                <p style={{ color: 'var(--text-secondary)', lineHeight: 1.6, marginBottom: '24px', fontSize: '14px' }}>
                  Competing hypotheses. One reality. Resolve which world the data supports.
                </p>
                <div style={{
                  display: 'inline-flex',
                  alignItems: 'center',
                  gap: '6px',
                  color: 'var(--text-muted)',
                  fontSize: '12px',
                  fontWeight: 400
                }}>
                  Enter →
                </div>
              </div>
            </div>

            {/* Engine Status */}
            <div className="fade-in fade-in-delay-3" style={{
              marginTop: '80px',
              textAlign: 'center',
              color: 'var(--text-muted)',
              fontSize: '11px',
              fontFamily: 'JetBrains Mono',
              letterSpacing: '1px'
            }}>
              ENGINE: ARBITER-72D v0.9 • 26MB • DETERMINISTIC
            </div>
          </div>
        );
      }

      // Perspective Shift Mode
      if (mode === 'perspective') {
        return (
          <div style={{ minHeight: '100vh', background: 'var(--bg-primary)' }}>
            {/* Header */}
            <header style={{
              padding: '20px 32px',
              borderBottom: '1px solid var(--border)',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'space-between',
              background: 'rgba(9, 9, 11, 0.8)',
              backdropFilter: 'blur(20px)',
              position: 'sticky',
              top: 0,
              zIndex: 100
            }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: '16px' }}>
                <button
                  onClick={() => { setMode(null); setResults([]); setSelectedPersona(null); }}
                  style={{
                    background: 'none',
                    border: 'none',
                    color: 'var(--text-secondary)',
                    cursor: 'pointer',
                    fontSize: '20px',
                    padding: '8px'
                  }}
                >
                  ←
                </button>
                <div>
                  <div style={{ fontSize: '12px', color: 'var(--text-muted)', letterSpacing: '2px' }}>
                    MODE 1
                  </div>
                  <div style={{ fontSize: '18px', fontWeight: 600 }}>
                    Perspective Shift
                  </div>
                </div>
              </div>
              <div style={{ 
                fontSize: '11px', 
                color: 'var(--text-muted)', 
                fontFamily: 'JetBrains Mono',
                letterSpacing: '1px'
              }}>
                ARBITER-72D • 26MB
              </div>
            </header>

            <div className="perspective-grid" style={{ display: 'grid', gridTemplateColumns: '320px 1fr', minHeight: 'calc(100vh - 81px)' }}>
              {/* Persona Selector */}
              <div className="persona-sidebar" style={{
                borderRight: '1px solid var(--border)',
                padding: '24px',
                background: 'var(--bg-secondary)'
              }}>
                <div style={{
                  fontSize: '11px',
                  letterSpacing: '2px',
                  color: 'var(--text-muted)',
                  marginBottom: '16px'
                }}>
                  SELECT OBSERVER
                </div>
                
                {PERSONAS.map((persona, idx) => (
                  <div
                    key={persona.id}
                    className="fade-in"
                    style={{ animationDelay: `${idx * 0.05}s` }}
                    onClick={() => runPerspectiveSearch(persona)}
                  >
                    <div style={{
                      padding: '16px',
                      borderRadius: '12px',
                      marginBottom: '8px',
                      cursor: 'pointer',
                      border: '1px solid',
                      borderColor: selectedPersona?.id === persona.id ? 'var(--text-muted)' : 'var(--border)',
                      background: selectedPersona?.id === persona.id ? 'var(--bg-tertiary)' : 'var(--bg-primary)',
                      transition: 'all 0.2s ease'
                    }}>
                      <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '6px' }}>
                        <span style={{ 
                          fontSize: '14px', 
                          color: selectedPersona?.id === persona.id ? 'var(--text-primary)' : 'var(--text-muted)',
                          fontFamily: 'JetBrains Mono'
                        }}>{persona.marker}</span>
                        <span style={{ fontWeight: 500, fontSize: '13px' }}>{persona.name}</span>
                      </div>
                      <div style={{ fontSize: '13px', color: 'var(--text-muted)', lineHeight: 1.5 }}>
                        {persona.description}
                      </div>
                    </div>
                  </div>
                ))}

                {/* Custom Search */}
                <div style={{ marginTop: '24px', marginBottom: '16px' }}>
                  <div style={{
                    fontSize: '11px',
                    letterSpacing: '2px',
                    color: 'var(--text-muted)',
                    marginBottom: '12px'
                  }}>
                    OR ASK ANYTHING
                  </div>
                  <div style={{ position: 'relative' }}>
                    <input
                      type="text"
                      placeholder="Search the corpus..."
                      value={customQuery}
                      onChange={(e) => setCustomQuery(e.target.value)}
                      onKeyDown={(e) => {
                        if (e.key === 'Enter' && customQuery.trim()) {
                          runPerspectiveSearch({ 
                            id: 'custom', 
                            name: 'Custom Query', 
                            marker: '◎',
                            description: customQuery,
                            query: customQuery 
                          });
                        }
                      }}
                      style={{
                        width: '100%',
                        padding: '12px 16px',
                        background: 'var(--bg-primary)',
                        border: '1px solid var(--border)',
                        borderRadius: '8px',
                        color: 'var(--text-primary)',
                        fontSize: '13px',
                        outline: 'none'
                      }}
                    />
                  </div>
                  <button
                    onClick={() => {
                      if (customQuery.trim()) {
                        runPerspectiveSearch({ 
                          id: 'custom', 
                          name: 'Custom Query', 
                          marker: '◎',
                          description: customQuery,
                          query: customQuery 
                        });
                      }
                    }}
                    style={{
                      width: '100%',
                      marginTop: '8px',
                      padding: '10px 16px',
                      background: customQuery.trim() ? 'var(--bg-tertiary)' : 'var(--bg-primary)',
                      border: '1px solid',
                      borderColor: customQuery.trim() ? 'var(--border-hover)' : 'var(--border)',
                      borderRadius: '6px',
                      color: customQuery.trim() ? 'var(--text-primary)' : 'var(--text-muted)',
                      fontSize: '12px',
                      fontWeight: 500,
                      cursor: customQuery.trim() ? 'pointer' : 'default',
                      transition: 'all 0.1s ease',
                      transform: 'translateY(0)'
                    }}
                    onMouseDown={(e) => {
                      if (customQuery.trim()) {
                        e.currentTarget.style.transform = 'translateY(1px)';
                        e.currentTarget.style.background = 'var(--bg-primary)';
                      }
                    }}
                    onMouseUp={(e) => {
                      e.currentTarget.style.transform = 'translateY(0)';
                      e.currentTarget.style.background = 'var(--bg-tertiary)';
                    }}
                    onMouseLeave={(e) => {
                      e.currentTarget.style.transform = 'translateY(0)';
                      e.currentTarget.style.background = customQuery.trim() ? 'var(--bg-tertiary)' : 'var(--bg-primary)';
                    }}
                  >
                    Search Corpus
                  </button>
                </div>

                {selectedPersona && results.length > 0 && (
                  <div style={{
                    marginTop: '24px',
                    padding: '16px',
                    background: 'var(--bg-primary)',
                    borderRadius: '12px',
                    border: '1px solid var(--border)'
                  }}>
                    <div style={{ fontSize: '11px', letterSpacing: '1px', color: 'var(--text-muted)', marginBottom: '12px' }}>
                      COHERENCE DISTRIBUTION
                    </div>
                    <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap' }}>
                      <div style={{ fontSize: '12px' }}>
                        <span style={{ color: 'var(--accent-emerald)' }}>●</span> High ({results.filter(r => r.score >= 0.6).length})
                      </div>
                      <div style={{ fontSize: '12px' }}>
                        <span style={{ color: 'var(--accent-amber)' }}>●</span> Med ({results.filter(r => r.score >= 0.4 && r.score < 0.6).length})
                      </div>
                      <div style={{ fontSize: '12px' }}>
                        <span style={{ color: 'var(--text-muted)' }}>●</span> Low ({results.filter(r => r.score < 0.4).length})
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* Results */}
              <div className="results-panel" style={{ padding: '24px 32px', overflowY: 'auto' }}>
                {loading ? (
                  <div style={{
                    display: 'flex',
                    flexDirection: 'column',
                    alignItems: 'center',
                    justifyContent: 'center',
                    height: '300px',
                    color: 'var(--text-muted)'
                  }}>
                    <div style={{
                      width: '40px',
                      height: '40px',
                      border: '3px solid var(--bg-tertiary)',
                      borderTopColor: 'var(--text-muted)',
                      borderRadius: '50%',
                      animation: 'spin 1s linear infinite',
                      marginBottom: '16px'
                    }} />
                    <style>{`@keyframes spin { to { transform: rotate(360deg); } }`}</style>
                    Analyzing through {selectedPersona?.name} perspective...
                  </div>
                ) : results.length === 0 ? (
                  <div style={{
                    display: 'flex',
                    flexDirection: 'column',
                    alignItems: 'center',
                    justifyContent: 'center',
                    height: '300px',
                    color: 'var(--text-muted)',
                    textAlign: 'center'
                  }}>
                    <div style={{ fontSize: '32px', marginBottom: '16px', opacity: 0.3, fontFamily: 'JetBrains Mono' }}>○</div>
                    <div style={{ fontSize: '16px', marginBottom: '8px' }}>Select an observer</div>
                    <div style={{ fontSize: '13px' }}>Same signals. Different meanings.</div>
                  </div>
                ) : (
                  <>
                    <div style={{
                      marginBottom: '24px',
                      padding: '16px 20px',
                      background: 'var(--bg-secondary)',
                      borderRadius: '12px',
                      border: '1px solid var(--border)',
                      display: 'flex',
                      alignItems: 'center',
                      gap: '16px'
                    }}>
                      <span style={{ fontSize: '18px', fontFamily: 'JetBrains Mono', color: 'var(--text-muted)' }}>{selectedPersona.marker}</span>
                      <div>
                        <div style={{ fontSize: '16px', fontWeight: 600, marginBottom: '2px' }}>{selectedPersona.name}</div>
                        <div style={{ color: 'var(--text-muted)', fontSize: '12px' }}>
                          {results.length} signals ranked by observer coherence
                        </div>
                      </div>
                    </div>

                    {results.map((doc, idx) => (
                      <div
                        key={doc.id}
                        className="fade-in"
                        style={{
                          animationDelay: `${idx * 0.03}s`,
                          padding: '20px',
                          marginBottom: '12px',
                          background: 'var(--bg-secondary)',
                          borderRadius: '12px',
                          border: '1px solid',
                          borderColor: doc.score >= 0.6 ? 'rgba(16, 185, 129, 0.3)' : 'var(--border)',
                          position: 'relative',
                          overflow: 'hidden'
                        }}
                      >
                        {/* Score bar */}
                        <div style={{
                          position: 'absolute',
                          top: 0,
                          left: 0,
                          height: '3px',
                          width: `${doc.score * 100}%`,
                          background: doc.score >= 0.6 ? 'var(--accent-emerald)' : 
                                     doc.score >= 0.4 ? 'var(--accent-amber)' : 'var(--text-muted)',
                          transition: 'width 0.5s ease'
                        }} />
                        
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '12px' }}>
                          <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                            <span style={{
                              padding: '4px 10px',
                              background: 'var(--bg-tertiary)',
                              borderRadius: '6px',
                              fontSize: '12px',
                              fontFamily: 'JetBrains Mono',
                              color: 'var(--text-secondary)'
                            }}>
                              {doc.id}
                            </span>
                            <span style={{
                              padding: '4px 10px',
                              background: doc.source === 'SIGINT' ? 'rgba(59, 130, 246, 0.15)' :
                                         doc.source === 'HUMINT' ? 'rgba(16, 185, 129, 0.15)' :
                                         doc.source === 'SATINT' ? 'rgba(139, 92, 246, 0.15)' :
                                         'rgba(255, 255, 255, 0.1)',
                              color: doc.source === 'SIGINT' ? 'var(--accent-blue)' :
                                    doc.source === 'HUMINT' ? 'var(--accent-emerald)' :
                                    doc.source === 'SATINT' ? 'var(--accent-purple)' :
                                    'var(--text-secondary)',
                              borderRadius: '6px',
                              fontSize: '11px',
                              fontWeight: 500,
                              letterSpacing: '0.5px'
                            }}>
                              {doc.source}
                            </span>
                            <span style={{ fontSize: '12px', color: 'var(--text-muted)' }}>
                              {doc.region}
                            </span>
                          </div>
                          <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                            <div style={{
                              width: '60px',
                              height: '4px',
                              background: 'var(--bg-tertiary)',
                              borderRadius: '2px',
                              overflow: 'hidden'
                            }}>
                              <div style={{
                                width: `${doc.score * 100}%`,
                                height: '100%',
                                background: doc.score >= 0.6 ? 'var(--accent-emerald)' : 
                                           doc.score >= 0.4 ? 'var(--accent-amber)' : 'var(--text-muted)',
                                transition: 'width 0.5s ease'
                              }} />
                            </div>
                            <span style={{
                              fontFamily: 'JetBrains Mono',
                              fontSize: '13px',
                              fontWeight: 500,
                              color: doc.score >= 0.6 ? 'var(--accent-emerald)' : 
                                    doc.score >= 0.4 ? 'var(--accent-amber)' : 'var(--text-muted)'
                            }}>
                              {doc.score.toFixed(3)}
                            </span>
                          </div>
                        </div>
                        <div style={{ color: 'var(--text-secondary)', fontSize: '14px', lineHeight: 1.7 }}>
                          {doc.content}
                        </div>
                      </div>
                    ))}
                  </>
                )}
              </div>
            </div>
          </div>
        );
      }

      // World Arbitration Mode
      if (mode === 'arbitration') {
        return (
          <div style={{ minHeight: '100vh', background: 'var(--bg-primary)' }}>
            {/* Header */}
            <header style={{
              padding: '20px 32px',
              borderBottom: '1px solid var(--border)',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'space-between',
              background: 'rgba(9, 9, 11, 0.8)',
              backdropFilter: 'blur(20px)',
              position: 'sticky',
              top: 0,
              zIndex: 100
            }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: '16px' }}>
                <button
                  onClick={() => { setMode(null); setArbitrationResults(null); }}
                  style={{
                    background: 'none',
                    border: 'none',
                    color: 'var(--text-secondary)',
                    cursor: 'pointer',
                    fontSize: '20px',
                    padding: '8px'
                  }}
                >
                  ←
                </button>
                <div>
                  <div style={{ fontSize: '12px', color: 'var(--text-muted)', letterSpacing: '2px' }}>
                    MODE 2
                  </div>
                  <div style={{ fontSize: '18px', fontWeight: 600 }}>
                    World Arbitration
                  </div>
                </div>
              </div>
              <div style={{ 
                fontSize: '11px', 
                color: 'var(--text-muted)', 
                fontFamily: 'JetBrains Mono',
                letterSpacing: '1px'
              }}>
                ARBITER-72D • 26MB
              </div>
            </header>

            <div style={{ padding: '40px', maxWidth: '1200px', margin: '0 auto' }}>
              {loading ? (
                <div style={{
                  display: 'flex',
                  flexDirection: 'column',
                  alignItems: 'center',
                  justifyContent: 'center',
                  height: '400px',
                  color: 'var(--text-muted)'
                }}>
                  <div style={{
                    width: '48px',
                    height: '48px',
                    border: '3px solid var(--bg-tertiary)',
                    borderTopColor: 'var(--text-muted)',
                    borderRadius: '50%',
                    animation: 'spin 1s linear infinite',
                    marginBottom: '20px'
                  }} />
                  <div style={{ fontSize: '16px', marginBottom: '8px' }}>Arbitrating realities...</div>
                  <div style={{ fontSize: '14px' }}>Scoring {INTELLIGENCE_CORPUS.length} signals against {HYPOTHESES.length} competing worlds</div>
                </div>
              ) : arbitrationResults ? (
                <>
                  {/* Winner Banner */}
                  <div className="fade-in winner-banner" style={{
                    padding: '40px',
                    borderRadius: '12px',
                    marginBottom: '32px',
                    background: 'var(--bg-secondary)',
                    border: `1px solid ${arbitrationResults.winner.hypothesis.color}`,
                    textAlign: 'center'
                  }}>
                    <div style={{ fontSize: '10px', letterSpacing: '3px', color: 'var(--text-muted)', marginBottom: '16px' }}>
                      RESOLVED WORLD STATE
                    </div>
                    <div style={{ fontSize: '28px', fontWeight: 600, marginBottom: '12px', color: 'var(--text-primary)' }}>
                      {arbitrationResults.winner.hypothesis.name}
                    </div>
                    <div className="winner-score" style={{ 
                      fontSize: '42px', 
                      fontWeight: 600, 
                      fontFamily: 'JetBrains Mono', 
                      marginBottom: '16px',
                      color: arbitrationResults.winner.hypothesis.color
                    }}>
                      {arbitrationResults.winner.avgScore.toFixed(4)}
                    </div>
                    <div style={{
                      fontSize: '13px',
                      color: 'var(--text-muted)'
                    }}>
                      +{arbitrationResults.delta}% delta vs {arbitrationResults.runnerUp.hypothesis.name}
                    </div>
                  </div>

                  {/* Other Hypotheses - subordinate row */}
                  <div className="arbitration-hypotheses" style={{ 
                    display: 'flex', 
                    flexWrap: 'wrap',
                    gap: '12px', 
                    marginBottom: '32px',
                    justifyContent: 'center'
                  }}>
                    {arbitrationResults.hypotheses.slice(1).map((h, idx) => (
                      <div
                        key={h.hypothesis.id}
                        className="fade-in"
                        style={{
                          animationDelay: `${(idx + 1) * 0.1}s`,
                          padding: '12px 16px',
                          borderRadius: '8px',
                          background: 'var(--bg-secondary)',
                          border: '1px solid var(--border)',
                          minWidth: '140px',
                          textAlign: 'center'
                        }}
                      >
                        <div style={{ fontSize: '11px', fontWeight: 500, color: 'var(--text-secondary)', marginBottom: '4px' }}>
                          {h.hypothesis.name}
                        </div>
                        <div style={{
                          fontFamily: 'JetBrains Mono',
                          fontSize: '13px',
                          color: 'var(--text-muted)'
                        }}>
                          {h.avgScore.toFixed(3)}
                        </div>
                      </div>
                    ))}
                  </div>

                  {/* Resolution Summary */}
                  <div className="fade-in fade-in-delay-3" style={{
                    padding: '20px',
                    borderRadius: '12px',
                    background: 'var(--bg-secondary)',
                    border: '1px solid var(--border)',
                    fontFamily: 'JetBrains Mono',
                    fontSize: '12px'
                  }}>
                    <div style={{ color: 'var(--text-muted)', marginBottom: '8px' }}>
                      RESOLUTION
                    </div>
                    <div style={{ color: 'var(--text-secondary)', lineHeight: 1.6 }}>
                      {INTELLIGENCE_CORPUS.length} signals scored against {HYPOTHESES.length} competing worlds. 
                      <span style={{ color: arbitrationResults.winner.hypothesis.color }}> {arbitrationResults.winner.hypothesis.name}</span> leads by {arbitrationResults.delta}% delta.
                    </div>
                  </div>
                </>
              ) : null}
            </div>
          </div>
        );
      }

      return null;
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
